<!doctype html>
<html>
    <head>
        <script src="mock.js"></script>
        <script>
            var ol = function ol() {
                var container = document.getElementById("screen_content");
                if (!container) container = document.body;

                var spacing = 10;
                var total_width = container.clientWidth;
                var running_height = 20;
                var image_height = (total_width - (2 * spacing)) * (102 / 378);
                
                if (typeof unitedPropertiesIf !== 'undefined' && unitedPropertiesIf.getProperty("debug").toUpperCase() == "TRUE") {
                    var r = document.createElement("div");
                    r.classList.add("row");
                    r.classList.add("one");
                    var i = document.createElement("div");
                    i.style.backgroundColor = "pink";
                    i.style.lineHeight = image_height.toString() + "px";
                    i.addEventListener("click", function() { unitedPropertiesIf.doAction("com.angryburg.uapp", "com.angryburg.uapp.activities.HiddenSettingsActivity", null); });
                    i.style.textAlign = "center";
                    i.innerText = "Debug options";
                    i.style.position = "absolute";
                    r.appendChild(i);
                    container.appendChild(r);
                }

                Array.prototype.slice.call(document.getElementsByClassName("row"), 0).forEach(function(elem) {
                    elem.style.top = running_height + "px";
                    running_height += image_height + spacing;
                    if (elem.classList.contains("one")) {
                        elem.children[0].style.left = spacing + "px";
                        elem.children[0].style.width = (total_width - (2 * spacing)).toString() + "px";
                    } else if (elem.classList.contains("one_one")) {
                        var each_width = (total_width - (3 * spacing))/2;
                        elem.children[0].style.left = spacing + "px";
                        elem.children[0].style.width = each_width.toString() + "px";
                        elem.children[1].style.left = (each_width + (2 * spacing)).toString() + "px";
                        elem.children[1].style.width = each_width.toString() + "px";
                    } else if (elem.classList.contains("one_two")) {
                        var first_width = (total_width - (3 * spacing))/3;
                        elem.children[0].style.left = spacing + "px";
                        elem.children[0].style.width = first_width.toString() + "px";
                        elem.children[1].style.left = (first_width + (spacing * 2)).toString() + "px";
                        elem.children[1].style.width = (first_width * 2).toString() + "px";
                    } else if (elem.classList.contains("one_three")) {
                        var first_width = (total_width - (3 * spacing))/4;
                        elem.children[0].style.left = spacing + "px";
                        elem.children[0].style.width = first_width.toString() + "px";
                        elem.children[1].style.left = (first_width + (spacing * 2)).toString() + "px";
                        elem.children[1].style.width = (first_width * 3).toString() + "px";
                    }
                });

                var theme = "neon";
                var playing = false;
                try {
                    theme = unitedPropertiesIf.getProperty("theme");
                    if (theme == null || theme == undefined || theme.trim().length == 0) {
                        theme = "neon";
                    }
                    playing = unitedPropertiesIf.getProperty("is_playing").toUpperCase() == "TRUE";
                    var startup_music = unitedPropertiesIf.getProperty("startup_music").toUpperCase() == "TRUE" && unitedPropertiesIf.getSessionVariable("started_startup_music").toUpperCase() != "TRUE";
                    
                    var opened = unitedPropertiesIf.getSessionVariable("open_phone_played")
                    if (opened != null && opened != undefined && opened.trim().toUpperCase() == "TRUE") {
                        opened = true;
                    } else {
                        unitedPropertiesIf.setSessionVariable("open_phone_played", true.toString());
                        unitedPropertiesIf.playSound("open_phone.mp3");
                    }
                    if (startup_music && !playing) {
                        playing = true;
                        unitedPropertiesIf.playSong("Safe Haven", false);
                        unitedPropertiesIf.setProperty("current_song", "Safe Haven");
                        unitedPropertiesIf.setSessionVariable("started_startup_music", "true");
                    }
                } catch (e) {
                }
                if (theme == null || theme == undefined || theme.trim().length == 0) {
                    theme = "neon";
                }
                
                container.style.background = "url(\"" + theme + "_home.png\") no-repeat center/cover fixed";
                if (theme == "motif") {
                    container.style.background = "url(\"" + theme + "_home.png\") repeat fixed";
                }

                Array.prototype.slice.call(document.getElementsByTagName("img"), 0).forEach(function(elem) {
                    elem.style.height = image_height.toString() + "px";
                    if (elem.id == "music" && !playing) elem.id = "music2"
                    elem.src = theme + "_" + elem.id + ".png";
                });

                var pn = document.getElementById("patch_notes");
                var pnt = document.getElementById("patch_notes_text");
                pnt.style.left = pn.style.left;
                pnt.style.width = pn.style.width;
                var set_version_text = false;
                try {
                    set_version_text = unitedPropertiesIf.getProperty("hide_version").toUpperCase() != "TRUE";
                } catch (e) {
                }
                if (set_version_text) {
                    pnt.innerText = unitedPropertiesIf.getProperty("version_notes");
                    pnt.style.paddingTop = pnt.style.paddingBottom = (pn.clientHeight / 8).toString() + "px";
                    var font_size = pn.clientHeight / 4;
                    pnt.style.fontSize = font_size.toString() + "px";
                    pnt.style.lineHeight = "1.5";
                    while (pnt.clientHeight > pn.clientHeight) {
                        font_size -= 1;
                        pnt.style.fontSize = font_size.toString() + "px";
                    }
                    pnt.style.top = (pn.style.top + (pn.clientHeight/2) - (pnt.clientHeight/2)).toString() + "px";
                }
                if (theme == "noir") pnt.style.color = "black";

                initPong(running_height + 40);
                initWindowDrag();
            }

            var kira_counter = 0;
            window.kira = function kira() {
                var kira_counter = Number(unitedPropertiesIf.getSessionVariable("kira_counter"))
                kira_counter++;
                unitedPropertiesIf.setSessionVariable("kira_counter", kira_counter.toString());
                unitedPropertiesIf.toast("Not Implemented Yet (press "+(5 - kira_counter).toString()+" times if you're a developer)")
                if (kira_counter > 4) {
                    unitedPropertiesIf.launchHTML('file:///android_res/raw/kira.html');
                }
            }
            window.dangeru = function() {
                unitedPropertiesIf.launchHTML(unitedPropertiesIf.getProperty("awoo_endpoint"));
            }

            function initPong(topOffset) {
                var container = document.getElementById('pong_area');
                var canvas = document.getElementById('pong_canvas');
                var ctx = canvas.getContext('2d');
                var scoreDisplay = document.getElementById('pong_score');
                var btnPlay = document.getElementById('btn_play');
                var btnAuto = document.getElementById('btn_auto');
                var btnSettings = document.getElementById('btn_settings');
                var settingsPanel = document.getElementById('settings_panel');
                var resetModal = document.getElementById('reset_modal');
                var inputPaddleW = document.getElementById('setting_paddle_w');
                var inputPaddleWNum = document.getElementById('setting_paddle_w_num');
                var inputBallS = document.getElementById('setting_ball_s');
                var inputBallSNum = document.getElementById('setting_ball_s_num');

                var availHeight = document.getElementById('screen_content').clientHeight - topOffset - 20;
                if(availHeight < 250) availHeight = 250; 

                container.style.top = topOffset + "px";
                container.style.height = availHeight + "px";
                
                canvas.width = container.clientWidth - 4;
                canvas.height = availHeight - 4;

                var state = {
                    playing: true,
                    auto: true,
                    pSpeed: 4,
                    bSpeedBase: 2,
                    bSpeed: 2,
                    pWidth: 149,
                    pHeight: 12,
                    bSize: 15,
                    score: [0, 0]
                };

                var savedScore = localStorage.getItem('pong_score');
                if(savedScore) {
                    state.score = JSON.parse(savedScore);
                }

                var ball = { x: canvas.width/2, y: canvas.height/2, dx: state.bSpeed, dy: -state.bSpeed };
                var p1 = { x: canvas.width/2 - state.pWidth/2, y: canvas.height - 40 }; 
                var p2 = { x: canvas.width/2 - state.pWidth/2, y: 20 };

                var leftDown = false;
                var rightDown = false;

                function resize() {
                    canvas.width = container.clientWidth - 4;
                    canvas.height = container.clientHeight - 4;
                    p1.y = canvas.height - 40;
                    if(ball.y > canvas.height) ball.y = canvas.height/2;
                }
                
                var resizeObserver = new ResizeObserver(function() { resize(); });
                resizeObserver.observe(container);

                function draw() {
                    ctx.clearRect(0,0, canvas.width, canvas.height);
                    ctx.fillStyle = 'white';
                    ctx.fillRect(p1.x, p1.y, state.pWidth, state.pHeight);
                    ctx.fillRect(p2.x, p2.y, state.pWidth, state.pHeight);
                    ctx.beginPath();
                    ctx.arc(ball.x, ball.y, state.bSize, 0, Math.PI*2);
                    ctx.fill();
                }

                function update() {
                    if(!state.playing) return;

                    if(state.auto) {
                        var target = ball.x - state.pWidth/2;
                        p1.x += (target - p1.x) * 0.12;
                    } else {
                        if(leftDown) p1.x -= state.pSpeed;
                        if(rightDown) p1.x += state.pSpeed;
                    }

                    var cpuTarget = ball.x - state.pWidth/2;
                    p2.x += (cpuTarget - p2.x) * 0.08;

                    if(p1.x < 0) p1.x = 0;
                    if(p1.x + state.pWidth > canvas.width) p1.x = canvas.width - state.pWidth;
                    if(p2.x < 0) p2.x = 0;
                    if(p2.x + state.pWidth > canvas.width) p2.x = canvas.width - state.pWidth;

                    ball.x += ball.dx;
                    ball.y += ball.dy;

                    if(ball.x + state.bSize > canvas.width || ball.x - state.bSize < 0) ball.dx = -ball.dx;

                    if(ball.y + state.bSize > p1.y && ball.y - state.bSize < p1.y + state.pHeight &&
                       ball.x > p1.x && ball.x < p1.x + state.pWidth) {
                           ball.dy = -Math.abs(ball.dy * 1.05);
                           ball.dx *= 1.05;
                    }

                    if(ball.y - state.bSize < p2.y + state.pHeight && ball.y + state.bSize > p2.y &&
                       ball.x > p2.x && ball.x < p2.x + state.pWidth) {
                           ball.dy = Math.abs(ball.dy * 1.05);
                           ball.dx *= 1.05;
                    }

                    if(ball.y > canvas.height) {
                        state.score[1]++;
                        resetBall();
                    } else if(ball.y < 0) {
                        state.score[0]++;
                        resetBall();
                    }
                    scoreDisplay.innerHTML = 'Score <span style="color:red;">' + state.score[0] + '</span> - ' + state.score[1];
                    localStorage.setItem('pong_score', JSON.stringify(state.score));
                }

                function resetBall() {
                    ball.x = canvas.width/2;
                    ball.y = canvas.height/2;
                    ball.dx = (Math.random() > 0.5 ? 1 : -1) * state.bSpeedBase;
                    ball.dy = (Math.random() > 0.5 ? 1 : -1) * state.bSpeedBase;
                }

                function loop() {
                    update();
                    draw();
                    requestAnimationFrame(loop);
                }

                var cLeft = document.getElementById('ctrl_left');
                var cRight = document.getElementById('ctrl_right');

                function userTakeover() {
                    if(state.auto) {
                        state.auto = false;
                        btnAuto.innerText = "Auto: Off";
                    }
                }

                cLeft.addEventListener('mousedown', function(){ leftDown = true; userTakeover(); });
                cLeft.addEventListener('mouseup', function(){ leftDown = false; });
                cLeft.addEventListener('touchstart', function(e){ e.preventDefault(); leftDown = true; userTakeover(); });
                cLeft.addEventListener('touchend', function(e){ e.preventDefault(); leftDown = false; });

                cRight.addEventListener('mousedown', function(){ rightDown = true; userTakeover(); });
                cRight.addEventListener('mouseup', function(){ rightDown = false; });
                cRight.addEventListener('touchstart', function(e){ e.preventDefault(); rightDown = true; userTakeover(); });
                cRight.addEventListener('touchend', function(e){ e.preventDefault(); rightDown = false; });

                window.addEventListener('keydown', function(e) {
                    if(e.key === "ArrowLeft" || e.key === "s" || e.key === "S") {
                        leftDown = true; userTakeover();
                    }
                    if(e.key === "ArrowRight" || e.key === "d" || e.key === "D") {
                        rightDown = true; userTakeover();
                    }
                });

                window.addEventListener('keyup', function(e) {
                    if(e.key === "ArrowLeft" || e.key === "s" || e.key === "S") leftDown = false;
                    if(e.key === "ArrowRight" || e.key === "d" || e.key === "D") rightDown = false;
                });

                btnPlay.onclick = function() {
                    state.playing = !state.playing;
                    btnPlay.innerText = state.playing ? "Pause" : "Play";
                };

                btnAuto.onclick = function() {
                    state.auto = !state.auto;
                    btnAuto.innerText = state.auto ? "Auto: On" : "Auto: Off";
                };

                btnSettings.onclick = function() {
                    settingsPanel.style.display = settingsPanel.style.display === "block" ? "none" : "block";
                };

                function sync(slider, num, prop) {
                    slider.addEventListener('input', function() { num.value = slider.value; state[prop] = parseInt(slider.value); });
                    num.addEventListener('input', function() { slider.value = num.value; state[prop] = parseInt(num.value); });
                }
                sync(inputPaddleW, inputPaddleWNum, 'pWidth');
                sync(inputBallS, inputBallSNum, 'bSize');

                document.getElementById('btn_reset_menu').onclick = function() {
                    resetModal.style.display = "flex";
                }

                document.getElementById('btn_close_modal').onclick = function() {
                    resetModal.style.display = "none";
                }

                document.getElementById('btn_rst_theme').onclick = function() {
                     try {
                        unitedPropertiesIf.setProperty("theme", "neon");
                        location.reload();
                     } catch(e) { location.reload(); }
                }

                document.getElementById('btn_rst_pong').onclick = function() {
                    state.score = [0, 0];
                    localStorage.removeItem('pong_score');
                    state.auto = true;
                    btnAuto.innerText = "Auto: On";
                    resetBall();
                    resetModal.style.display = "none";
                }

                loop();
            }

            function initWindowDrag() {
                var win = document.getElementById("emulator_window");
                var header = document.getElementById("window_header");
                if (!win || !header) return;

                var isDragging = false;
                var offsetX = 0;
                var offsetY = 0;

                header.onmousedown = function(e) {
                    isDragging = true;
                    
                    var rect = win.getBoundingClientRect();
                    
                    if (win.style.transform !== "none") {
                        win.style.left = rect.left + "px";
                        win.style.top = rect.top + "px";
                        win.style.transform = "none"; 
                    }
                    
                    offsetX = e.clientX - rect.left;
                    offsetY = e.clientY - rect.top;
                };

                document.onmouseup = function() {
                    isDragging = false;
                };

                document.onmousemove = function(e) {
                    if (isDragging) {
                        var x = e.clientX - offsetX;
                        var y = e.clientY - offsetY;
                        win.style.left = x + "px";
                        win.style.top = y + "px";
                    }
                };
            }
        </script>
<style>
    body {
        margin: 0;
        min-height: 100vh;
        font-family: monospace;
        background-color: black;
        overflow: hidden; 
    }

    #emulator_window {
        width: 100%;
        height: 100%;
        position: relative;
        background: transparent;
    }

    #window_header {
        display: none;
    }

    #screen_content {
        position: relative;
        width: 100%;
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    @media (min-width: 768px) {
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #000;
        }

        #emulator_window {
            width: 450px; 
            height: 800px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            border: 2px solid #dfdfdf;
            border-style: outset;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            background-color: #c0c0c0;
            resize: both;
            overflow: hidden;
            min-width: 320px;
            min-height: 480px;
        }

        #window_header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 24px;
            background: #000080;
            padding: 0 4px;
            cursor: default;
            user-select: none;
            flex-shrink: 0;
            margin: 2px;
        }

        .win-title {
            color: white;
            font-family: Tahoma, sans-serif;
            font-size: 11px;
            font-weight: bold;
            margin-left: 2px;
            letter-spacing: 0.5px;
        }

        .win-controls {
            display: flex;
            gap: 2px;
        }

        .win-btn {
            width: 16px;
            height: 14px;
            border: 1px solid #fff;
            border-right-color: #404040;
            border-bottom-color: #404040;
            border-left-color: #dfdfdf;
            border-top-color: #dfdfdf;
            background: #c0c0c0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: inset 1px 1px 0px #fff, inset -1px -1px 0px #808080;
        }

        .win-btn:active {
            border: 1px solid #404040;
            border-right-color: #fff;
            border-bottom-color: #fff;
            box-shadow: none;
        }

        .win-icon {
            color: black;
            font-family: sans-serif;
            font-size: 10px;
            font-weight: bold;
            line-height: 10px;
        }

        #screen_content {
            flex-grow: 1;
            position: relative;
            background-color: white; 
            overflow-y: scroll;
            border: 2px solid #808080;
            border-style: inset;
            margin: 0 2px 2px 2px;
        }
        
        #screen_content::-webkit-scrollbar {
            width: 16px;
            background: #c0c0c0;
        }
        #screen_content::-webkit-scrollbar-thumb {
            background: #c0c0c0;
            border: 2px solid #dfdfdf;
            border-style: outset;
        }
        #screen_content::-webkit-scrollbar-button {
            background: #c0c0c0;
            border: 2px solid #dfdfdf;
            border-style: outset;
            height: 16px;
        }
    }

    img, .row, #patch_notes_text {
        display: block;
        position: absolute;
    }
    #patch_notes_text {
        text-align: center;
        color: white;
    }

    #pong_area {
        position: absolute;
        left: 10px;
        right: 10px;
        border: 3px solid white;
        mix-blend-mode: difference;
        display: block;
    }
    
    #pong_header {
        position: absolute;
        top: -45px;
        width: 100%;
        height: 45px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        pointer-events: none;
    }

    #pong_score {
        font-size: 20px;
        font-weight: bold;
        color: white;
        background: transparent;
        pointer-events: auto;
    }

    .pong_ui_group {
        pointer-events: auto;
        z-index: 100;
    }

    .pong-btn {
        background: white;
        color: black;
        border: 2px solid black;
        font-family: monospace;
        padding: 6px 10px;
        cursor: pointer;
        margin-left: 5px;
        font-size: 14px;
        font-weight: bold;
    }

    #pong_canvas {
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        z-index: 1;
    }

    .pong-ctrl {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 50%;
        z-index: 2;
    }
    #ctrl_left { left: 0; }
    #ctrl_right { right: 0; }

    #settings_panel {
        display: none;
        position: absolute;
        top: 45px;
        right: 0;
        background: white;
        color: black;
        padding: 15px;
        border: 2px solid black;
        z-index: 150;
        width: 250px;
    }

    .set-row { margin-bottom: 12px; }
    .set-row label { display: block; font-size: 12px; margin-bottom: 4px; }
    .set-row input[type=range] { width: 140px; vertical-align: middle; }
    .set-row input[type=number] { width: 50px; vertical-align: middle; font-size: 14px; }

    #reset_modal {
        display: none;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.7);
        z-index: 999;
        justify-content: center;
        align-items: center;
    }
    
    .modal-box {
        background: white;
        color: black;
        padding: 30px;
        border: 4px solid black;
        text-align: center;
        width: 80%;
        max-width: 400px;
    }
    .modal-box button {
        display: block;
        width: 100%;
        margin-bottom: 15px;
        padding: 15px;
        font-family: monospace;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
    }
</style>
    </head>
    <body onLoad='ol()'>
        <div id="emulator_window">
            <div id="window_header">
                <div class="win-title">uPhone Emulator</div>
                <div class="win-controls">
                    <div class="win-btn"><div class="win-icon">_</div></div>
                    <div class="win-btn"><div class="win-icon">â–¡</div></div>
                    <div class="win-btn"><div class="win-icon">X</div></div>
                </div>
            </div>
            <div id="screen_content">
                <div class="row one_three">
                    <img id="dangeru" onClick="window.dangeru()" />
                    <img id="patch_notes" onClick="unitedPropertiesIf.launchHTML('file:///android_res/raw/patch_notes.html')" />
                    <div id="patch_notes_text" onClick="unitedPropertiesIf.launchHTML('file:///android_res/raw/patch_notes.html')"></div>
                </div>
                <div class="row one_one">
                    <img id="ae" onClick="unitedPropertiesIf.launchHTML('https://augmented.dangeru.us/')" />
                    <img id="music" onClick='unitedPropertiesIf.launchHTML("file:///android_res/raw/music.html");' />
                </div>
                <div class="row one">
                    <img id="save" onClick="unitedPropertiesIf.launchHTML('http://sukeban.moe')" />
                </div>
                <div class="row one_one">
                    <img id="camo" onClick="unitedPropertiesIf.launchHTML('file:///android_res/raw/camo.html')" />
                    <img id="kira" onClick="unitedPropertiesIf.launchHTML('https://kiramiki.dangeru.us')" />
                </div>

                <div id="pong_area">
                    <div id="pong_header">
                        <div id="pong_score">Score <span style="color:red;">0</span> - 0</div>
                        <div class="pong_ui_group">
                            <button class="pong-btn" id="btn_play">Pause</button>
                            <button class="pong-btn" id="btn_auto">Auto: On</button>
                            <button class="pong-btn" id="btn_settings">Settings</button>
                        </div>
                    </div>
                    
                    <canvas id="pong_canvas"></canvas>
                    
                    <div id="ctrl_left" class="pong-ctrl"></div>
                    <div id="ctrl_right" class="pong-ctrl"></div>

                    <div id="settings_panel">
                        <div class="set-row">
                            <label>Paddle Width</label>
                            <input type="range" id="setting_paddle_w" min="20" max="300" value="149">
                            <input type="number" id="setting_paddle_w_num" value="149">
                        </div>
                        <div class="set-row">
                            <label>Ball Size</label>
                            <input type="range" id="setting_ball_s" min="5" max="50" value="15">
                            <input type="number" id="setting_ball_s_num" value="15">
                        </div>
                        <button class="pong-btn" id="btn_reset_menu" style="width:100%; margin-top:10px;">Reset</button>
                    </div>
                </div>

                <div id="reset_modal">
                    <div class="modal-box">
                        <p style="font-size: 18px; font-weight: bold;">Reset Options</p>
                        <button id="btn_rst_theme">Theme (Neon)</button>
                        <button id="btn_rst_pong">Pong Score</button>
                        <button id="btn_close_modal" style="margin-top:10px; background: #eee;">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>
